
dist: trusty

sudo: required

language: python

python:
  - "2.7"

branches:
  only:
    master


# Install dependencies
before_install:
  - FLORENCEPATH=$(pwd)
  - echo $FLORENCEPATH
  - sudo apt-get update --fix-missing
  # Install BLAS libraries
  - echo -ne '\n' | sudo apt-get install gfortran libblas-dev liblapack-dev libatlas-base-dev libsuitesparse-dev
  - cd ~
  # Install OpenCascade
  - OCETAG="OCE-0.15" 
  - OCEMAKEPATH="oce/build"
  # Install all OCC dependencies
  - sudo apt-get install -fy cmake libx11-dev mesa-common-dev freeglut3-dev libfreetype6-dev libc6-dev libstdc++6 
  - sudo apt-get install libstdc++-4.8-dev -fy build-essential gcc g++ libftgl-dev xorg-dev tcl-dev tk-dev swig
  - git clone --branch $OCETAG https://github.com/tpaviot/oce.git
  - mkdir $OCEMAKEPATH && cd $OCEMAKEPATH
  - cmake ..
  - travis_wait 100 make '-j'$(nproc) 
  - sudo make install/strip
  # Eigen install
  - cd ~
  - wget http://bitbucket.org/eigen/eigen/get/3.2.7.tar.bz2
  - tar -xvf 3.2.7.tar.bz2
  - sudo mv eigen-eigen-b30b87236a1b /usr/local/include/eigen/ 
  # pypi packages
  - cd $FLORENCEPATH
  # - echo -ne '\n' | sudo apt-get install python-numpy python-scipy
  - travis_wait 50 pip install -r "requirements.txt"
  # update the cache
  - sudo ldconfig

install:
  # Setup florence - build interfaces
  - cd $FLORENCEPATH; python setup.py

script:
  # Run florence test suite
  - cd $FLORENCEPATH; nosetests -x --with-coverage tests/test.py

notifications:
  email: false
